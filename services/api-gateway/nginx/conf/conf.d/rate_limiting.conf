# Rate limiting configuration

# Define rate limiting zones
limit_req_zone $binary_remote_addr zone=api_limit:10m rate=60r/m;
limit_req_zone $binary_remote_addr zone=login_limit:10m rate=5r/m;
limit_req_zone $binary_remote_addr zone=admin_limit:10m rate=30r/m;
limit_req_zone $binary_remote_addr zone=media_limit:10m rate=120r/m;

# Define cache zones
proxy_cache_path /var/cache/nginx/api_cache levels=1:2 keys_zone=api_cache:10m max_size=1g inactive=60m;
proxy_cache_path /var/cache/nginx/media_cache levels=1:2 keys_zone=media_cache:20m max_size=10g inactive=7d;

# Set default rate limit status
limit_req_status 429;

# Define error page for rate limiting
error_page 429 = @rate_limited;

# Custom response for rate limited requests
location @rate_limited {
    default_type application/json;
    return 429 '{"error": "Too many requests. Please try again later.", "status": 429}';
}